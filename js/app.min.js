let currentPage=1,agentsPerPage=10,filteredAgents=[],currentSort="rating";function initializeApp(){initMobileMenu(),initSmoothScrolling(),initFormHandling(),initAnimations(),initScrollToTop()}function initMobileMenu(){let a=document.querySelector(".mobile-menu-btn"),t=document.querySelector(".nav");a&&t&&(a.addEventListener("click",function(){t.classList.toggle("nav-open"),a.classList.toggle("active"),a.querySelectorAll("span").forEach((e,t)=>{a.classList.contains("active")?(0===t&&(e.style.transform="rotate(45deg) translate(5px, 5px)"),1===t&&(e.style.opacity="0"),2===t&&(e.style.transform="rotate(-45deg) translate(7px, -6px)")):(e.style.transform="",e.style.opacity="")})}),t.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{t.classList.remove("nav-open"),a.classList.remove("active"),a.querySelectorAll("span").forEach(e=>{e.style.transform="",e.style.opacity=""})})}))}function initSmoothScrolling(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t,e=this.getAttribute("href"),e=document.querySelector(e);e&&(t=document.querySelector(".header").offsetHeight,e=e.offsetTop-t-20,window.scrollTo({top:e,behavior:"smooth"}))})})}function initFormHandling(){document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",function(e){e.preventDefault();e=new FormData(this),e=Object.fromEntries(e);validateFormData(this,e)&&submitFormData(this,e)}),e.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("blur",function(){validateField(this)}),e.addEventListener("input",function(){clearFieldError(this),this.form.id.includes("registration")&&updateProgress()})})})}function validateFormData(e,t){let a=!0;return e.querySelectorAll("[required]").forEach(e=>{validateField(e)||(a=!1)}),a}function validateField(e){var t=e.value.trim(),a=e.name;if(clearFieldError(e),e.hasAttribute("required")&&!t)return showFieldError(e,"この項目は必須です"),!1;switch(a){case"email":case"contactEmail":if(t&&!isValidEmail(t))return showFieldError(e,"有効なメールアドレスを入力してください"),!1;break;case"phone":case"contactPhone":if(t&&!isValidPhone(t))return showFieldError(e,"有効な電話番号を入力してください"),!1;break;case"companyWebsite":case"website":case"linkedin":if(t&&!isValidUrl(t))return showFieldError(e,"有効なURLを入力してください"),!1}return!0}function showFieldError(e,t){e.classList.add("error");var a=e.parentNode.querySelector(".error-message"),a=(a&&a.remove(),document.createElement("span"));a.className="error-message",a.textContent=t,a.style.cssText=`
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: block;
    `,e.parentNode.appendChild(a)}function clearFieldError(e){e.classList.remove("error");e=e.parentNode.querySelector(".error-message");e&&e.remove()}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function isValidPhone(e){return/^[\d\-\+\(\)\s]+$/.test(e)&&10<=e.replace(/\D/g,"").length}function isValidUrl(e){try{return new URL(e),e.startsWith("http://")||e.startsWith("https://")}catch{return!1}}function submitFormData(e,t){let a=e.querySelector('button[type="submit"]'),r=a.innerHTML;a.innerHTML='<i class="fas fa-spinner fa-spin"></i> 送信中...',a.disabled=!0,setTimeout(()=>{console.log("Form data:",t),showSuccessMessage(e),e.reset(),e.id.includes("registration")&&(updateProgress(),clearSavedData(e.id)),a.innerHTML=r,a.disabled=!1},2e3)}function showSuccessMessage(e){var t=e.querySelector(".success-message, .form-error"),t=(t&&t.remove(),document.createElement("div"));t.className="success-message";let a="お問い合わせありがとうございます。";e.id.includes("registration")&&(a="登録申請を受け付けました。審査後、3営業日以内にご連絡いたします。"),t.innerHTML=`
        <div style="text-align: center;">
            <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--success); margin-bottom: 1rem;">${a}</h3>
        </div>
    `,t.style.cssText=`
        background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
        border: 1px solid #bbf7d0;
        padding: 2rem;
        border-radius: var(--radius-lg);
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
    `,e.insertBefore(t,e.firstChild),t.scrollIntoView({behavior:"smooth",block:"center"})}function updateProgress(){var e=document.querySelector('[id*="registration-form"]');if(e){e=e.querySelectorAll("[required]");let t=0;var a=e.length,e=(e.forEach(e=>{"checkbox"!==e.type&&e.value.trim()&&t++}),Math.round(t/a*100)),a=document.getElementById("progress-text"),r=document.getElementById("progress-fill");a&&r&&(a.textContent=e+"%",r.style.width=e+"%")}}function initializeSearch(){generateDummyAgents(),handleURLParameters(),displayAgents(filteredAgents,1),updatePagination();var e=document.getElementById("keyword-search"),e=(e&&e.addEventListener("input",debounce(performSearch,300)),["specialty-filter","experience-filter","rating-filter","location-filter"].forEach(e=>{e=document.getElementById(e);e&&e.addEventListener("change",performSearch)}),document.getElementById("sort-by"));e&&e.addEventListener("change",function(){currentSort=this.value,performSearch()})}function generateDummyAgents(){var t=[{id:1,name:"田中 AI子",title:"シニアMLエンジニアリング・エージェント",avatar:"images/people/consultant1.jpg",location:"東京・リモート対応",rating:4.9,reviewCount:127,specialties:["機械学習","深層学習","GAFAM転職","PyTorch"],summary:"Google、OpenAI出身。8年間で200名以上のMLエンジニアの転職成功。平均年収向上率145%。",verified:!0,primarySpecialty:"機械学習"}];filteredAgents=[...t];for(let e=t.length;e<100;e++)filteredAgents.push(generateRandomAgent(e+1))}function generateRandomAgent(e){var t=["佐藤","山田","鈴木","高橋","田中"],a=["機械学習","ロボティクス","NLP","コンピュータビジョン","データサイエンス"];return{id:e,name:t[e%t.length]+" "+e,title:"AI専門エージェント",avatar:`images/people/consultant${e%3+1}.jpg`,location:"東京・リモート対応",rating:+(4+.9*Math.random()).toFixed(1),reviewCount:Math.floor(20+150*Math.random()),specialties:[a[e%a.length]],summary:`AI分野で${Math.floor(30+100*Math.random())}名以上の転職支援実績。`,verified:.3<Math.random(),primarySpecialty:a[e%a.length]}}function performSearch(){let t=document.getElementById("keyword-search")?.value.toLowerCase()||"";var e=filteredAgents.filter(e=>!t||[e.name,e.title,...e.specialties].join(" ").toLowerCase().includes(t));displayAgents(e,1),updateResultsCount(e.length)}function displayAgents(e,t){var a,r=document.getElementById("agents-grid");r&&(a=(t=(t-1)*agentsPerPage)+agentsPerPage,e=e.slice(t,a),r.innerHTML=e.map(e=>createAgentCard(e)).join(""))}function createAgentCard(a){var e=Array.from({length:5},(e,t)=>`<i class="fas fa-star${t<Math.floor(a.rating)?"":" opacity-30"}"></i>`).join("");return`
        <div class="agent-card">
            <div class="agent-header">
                <div class="agent-avatar">
                    <img src="${a.avatar}" alt="${a.name}">
                    ${a.verified?'<div class="verified-badge"><i class="fas fa-check"></i></div>':""}
                </div>
                <div class="agent-basic-info">
                    <h3 class="agent-name">${a.name}</h3>
                    <p class="agent-title">${a.title}</p>
                    <div class="agent-location">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${a.location}</span>
                    </div>
                </div>
                <div class="agent-rating">
                    <div class="stars">${e}</div>
                    <span class="rating-score">${a.rating}</span>
                </div>
            </div>
            <div class="agent-specialties">
                ${a.specialties.map(e=>`<span class="specialty-tag">${e}</span>`).join("")}
            </div>
            <p class="agent-summary">${a.summary}</p>
            <div class="agent-actions">
                <button class="btn btn-primary" onclick="bookConsultation(${a.id})">相談予約</button>
                <button class="btn btn-outline" onclick="viewProfile(${a.id})">詳細</button>
            </div>
        </div>
    `}function updatePagination(){var e=document.getElementById("pagination");e&&(e.innerHTML='<span class="page-info">1 / 10</span>')}function updateResultsCount(e){var t=document.getElementById("results-count");t&&(t.textContent=e+"件のエージェントが見つかりました")}function bookConsultation(e){alert("相談予約機能は準備中です。")}function viewProfile(e){alert("プロフィール詳細機能は準備中です。")}function initializeRegistrationForm(){initFormValidation(),initAutoSave("agentRegistrationData")}function initializeCompanyRegistrationForm(){initFormValidation(),initAutoSave("companyRegistrationData")}function initAutoSave(t){var e=document.querySelector('[id*="registration-form"]');e&&(loadSavedData(t),e.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("input",debounce(()=>saveFormData(t),1e3))}))}function saveFormData(e){var t=document.querySelector('[id*="registration-form"]');t&&(t=new FormData(t),t=Object.fromEntries(t),localStorage.setItem(e,JSON.stringify(t)))}function loadSavedData(e){e=localStorage.getItem(e);if(e){let a=JSON.parse(e);Object.keys(a).forEach(e=>{var t=document.querySelector(`[name="${e}"]`);t&&"checkbox"!==t.type&&(t.value=a[e])})}}function clearSavedData(e){e=e.includes("company")?"companyRegistrationData":"agentRegistrationData";localStorage.removeItem(e)}function initAnimations(){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("animate-in")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".service-card, .flow-step, .consultant-card, .section-header").forEach(e=>{e.classList.add("animate-on-scroll"),t.observe(e)})}function initScrollToTop(){let e=document.querySelector(".scroll-to-top");e||((e=document.createElement("button")).className="scroll-to-top",e.innerHTML='<i class="fas fa-arrow-up"></i>',e.style.cssText=`
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        `,e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.body.appendChild(e)),window.addEventListener("scroll",()=>{300<window.pageYOffset?(e.style.transform="translateY(0)",e.style.opacity="1"):(e.style.transform="translateY(100px)",e.style.opacity="0")})}function handleURLParameters(){var e,t=new URLSearchParams(window.location.search).get("specialty");t&&(e=document.getElementById("specialty-filter"))&&(e.value=t,performSearch())}function debounce(t,a){let r;return function(...e){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),t(...e)},a)}}document.addEventListener("DOMContentLoaded",function(){initializeApp(),window.location.pathname.includes("search")&&initializeSearch(),document.getElementById("registration-form")&&initializeRegistrationForm(),document.getElementById("company-registration-form")&&initializeCompanyRegistrationForm()});let additionalStyles=`
    .animate-on-scroll {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.6s ease;
    }
    
    .animate-on-scroll.animate-in {
        opacity: 1;
        transform: translateY(0);
    }
    
    .form-group input.error,
    .form-group textarea.error {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }
    
    @media (max-width: 768px) {
        .nav {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .nav.nav-open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .nav-list {
            flex-direction: column;
            padding: 1rem;
            gap: 0.5rem;
        }
    }
`,styleSheet=document.createElement("style");styleSheet.textContent=additionalStyles,document.head.appendChild(styleSheet),window.bookConsultation=bookConsultation,window.viewProfile=viewProfile;